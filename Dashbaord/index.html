<html>
    <head>
        <title>{{.Config.Name}}</title>
        <meta http-equiv="refresh" content="1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="bootstrap.min.css">
        <style>
            * {
                font-family: monospace !important;
                font-size:10pt !important;
            }
            td{
                padding:2px !important;
                vertical-align:middle;
            }
            .table-border-show td{
                border:1px black solid;
            }
            .nav-link{
                transition:none;
            }
            .badge{
                padding:2px !important;
            }
        </style>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid ">
                <a class="navbar-brand" href="/">{{.Config.Name}}</a>
            </div>
        </nav>

        <div class="container-fluid p-4">
            <div class="row">
                {{range .AutomationsFiles }}
                    <div class="col-xxl-3 col-xl-4 col-lg-6 col-md-12">
                        <div class="card {{if .Search }} bg-warning {{end}} text-center mt-2 p-1">
                            <a style="color:white" href="/{{ .QueryEscapeShortName }}">{{ .ShortName }}</a>
                        </div>
                    </div>
                {{end}}
            </div>
        </div>

        <div class="container-fluid p-4">
            {{range .Config.Automations}}
                {{if not .Hidden }} 
                    <div class="card mb-4" style="border:1px black solid">
                        <div class="card-header bg-dark p-2 border-2 {{if or (.Triggered) (.Triggered_Time | range2s) }} border-success {{else}} border-danger {{end}}" style="border-radius:0;">
                            <span class="badge {{if .Triggered_Time | range2s }} bg-warning {{ else }} bg-info {{ end }}">{{.Triggered_Time | diff }}</span>
                            <span class="badge bg-info" >{{.Mode}}</span>
                            {{ if .Retrigger  }} <span class="badge bg-success">Retrigger</span> {{end}}
                            <span style="font-size:11pt !important">{{.Name}}</span>
                            <span style="float:right" class="text-muted"> {{.File}}</span>
                            <table class="table text-left border-none table-borderless m-0 mt-2">
                                <tr>
                                    <td>Triggered <span class="badge bg-info">{{ .Triggered_Time | diff }}</span></td>
                                    <td>Pause</td>
                                    <td>Reminder</td>
                                    <td>Delay</td>
                                    <td>Value <span class="badge bg-info">{{ .Value_Time | diff }}</span></td>
                                </tr>
                                <tr>
                                    <td class="{{if .Triggered_Time | range2s }} bg-warning {{ end }}" >{{.Triggered}}</td>
                                    <td class="{{if . | automationInPause }} bg-warning {{ end }}" >{{.Pause}}</td>
                                    <td class="{{if .Reminder_Active }} bg-warning {{ end }}" >{{.Reminder}}</td>
                                    <td class="{{if .Delay_Active }} bg-warning {{ end }}" > {{.Delay}}</td>
                                    <td class="{{if .Value_Time | range2s }} bg-warning {{ end }}" >{{.Value}}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="card-body bg-secondary p-2">
                            {{if . | automationHaveConstraintMqtt }} 
                                <table class="table bg-dark table-border-show table-bordered m-0 mt-1">
                                    <tr>
                                        <td><b>MQTT Constraints</b> - Topic</td>
                                        <td>Object</td>
                                        <td>Comparator</td>
                                        <td>Value</td>
                                        <td>Reset</td>
                                        <td>Timeout</td>
                                        <td>Triggered</td>
                                        <td>Value</td>
                                        <td>Options</td>
                                    </tr>
                                    {{range .Constraints}}
                                        {{if .Mqtt}}
                                            <tr class="{{if or (.Triggered) (.Triggered_Time | range2s) }} bg-success {{ end }}" >
                                                <td>{{.Mqtt_Parsed.Topic}}</td>
                                                <td>{{.Mqtt_Parsed.Object}}</td>
                                                <td>{{.Mqtt_Parsed.Comparator}}</td>
                                                <td>{{.Mqtt_Parsed.Value}}</td>
                                                <td>{{.Mqtt_Parsed.Reset}}</td>
                                                <td>{{.Mqtt_Parsed.Timeout}}</td>
                                                <td class="{{if .Triggered_Time | range2s }}  bg-warning {{ end }}" >{{.Triggered}} <span class="badge bg-info">{{.Triggered_Time | diff }}</span></td>
                                                <td class="{{if .Value_Time | range2s }} bg-warning {{ end }}" >{{.Value}} <span class="badge bg-info">{{.Value_Time | diff }}</span></td>
                                                <td>
                                                    {{ if .Mqtt_Parsed.BlockRetained  }} <span class="badge bg-warning">BlockRetained</span> {{end}}
                                                    {{ if .Mqtt_Parsed.NoTrigger  }} <span class="badge bg-warning">NoTrigger</span> {{end}}
                                                    {{ if .Mqtt_Parsed.NoValue  }} <span class="badge bg-warning">NoValue</span> {{end}}
                                                </td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            {{end}}

                            {{if . | automationHaveConstraintCron }} 
                                <table class="table bg-dark table-border-show m-0 mt-1">
                                    <tr>
                                        <td><b>CRON Constraints</b> - NextTime</td>
                                        <td>Reset</td>
                                        <td>Triggered</td>
                                        <td>Options</td>
                                    </tr>
                                    {{range .Constraints}}
                                        {{if .Cron}}
                                            <tr class="{{if or (.Triggered) (.Triggered_Time | range2s) }} bg-success {{ end }}" >
                                                <td>{{.Cron_Parsed.NextTime}}</td>
                                                <td>{{.Cron_Parsed.Reset}}</td>
                                                <td class="{{if .Triggered_Time | range2s }} bg-warning {{ end }}">{{.Triggered}} <span class="badge bg-info">{{.Triggered_Time | diff }}</span></td>
                                                <td>
                                                    {{ if .Cron_Parsed.NoTrigger  }} <span class="badge bg-warning">NoTrigger</span> {{end}}
                                                </td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            {{end}}

                            <hr >

                            {{if . | automationHaveActionMqtt }} 
                                <table class="table bg-dark table-border-show m-0 mt-1">
                                    <tr>
                                        <td><b>MQTT Actions</b> - Topic</td>
                                        <td>Object</td>
                                        <td>Value</td>
                                        <td>Options</td>
                                    </tr>
                                    {{range .Actions}}
                                        {{if .Mqtt}}
                                            <tr class="{{if or (.Triggered) (.Triggered_Time | range2s) }} bg-success {{ end }}" >
                                                <td>{{.Mqtt_Parsed.Topic}}</td>
                                                <td>{{.Mqtt_Parsed.Object}}</td>
                                                <td>{{.Mqtt_Parsed.Value}}</td>
                                                <td>
                                                    {{ if .Mqtt_Parsed.Retained  }} <span class="badge bg-warning">Retained</span> {{end}}
                                                </td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            {{end}}

                            {{if . | automationHaveActionHttp }} 
                                <table class="table bg-dark table-border-show m-0 mt-1">
                                    <tr>
                                        <td><b>HTTP Actions</b> - URL</td>
                                    </tr>
                                    {{range .Actions}}
                                        {{if .Http}}
                                            <tr class="{{if or (.Triggered) (.Triggered_Time | range2s ) }} bg-success {{ end }}" >
                                                <td>{{.Http}}</td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            {{ end }}

                           

                        </div>    
                    </div>
                {{end}}
            {{end}}
        </div>

    </body>

</html>